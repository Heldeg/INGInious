var UserStatistics={colors:{COMPILATION_ERROR:"rgb(236,199,6)",TIME_LIMIT_EXCEEDED:"rgb(50,120,202)",MEMORY_LIMIT_EXCEEDED:"rgb(119,92,133)",RUNTIME_ERROR:"rgb(2,164,174)",WRONG_ANSWER:"rgb(227,79,54)",INTERNAL_ERROR:"rgb(137,139,37)",ACCEPTED:"rgb(35,181,100)"}},UserTrialsAndBestGradeStatistic=function(){function t(t){this.course_id=t,this.div_id="tries_per_task",this.RESOURCE_URL="/api/stats/student/trials_and_best_grade"}return t.prototype=Object.create(Statistic.prototype),t.prototype._fetchData=function(){return $.getJSON(this.RESOURCE_URL,{course_id:this.course_id})},t.prototype._plotData=function(t){for(var s=this._getRatio(t),e={},i=Object.keys(UserStatistics.colors),r=0;r<i.length;r++)e[i[r]]={mode:"markers",name:i[r],marker:{color:UserStatistics.colors[i[r]],sizemode:"area",sizeref:s,size:[]},text:[],x:[],y:[]};for(r=0;r<t.length;r++){var a=t[r].result;e[a].x.push(t[r].taskid),e[a].y.push(t[r].grade),e[a].text.push(t[r].tried+" submissions"),e[a].marker.size.push(t[r].tried)}var o=[];for(r=0;r<i.length;r++)o.push(e[i[r]]);Plotly.purge(this.div_id),Plotly.plot(this.div_id,o,{xaxis:{title:"Task"},yaxis:{title:"Grade",range:[-10,110]},margin:{t:20},hovermode:"closest"},{showLink:!1})},t.prototype._getRatio=function(t){for(var s=0,e=0;e<t.length;e++)s+=t[e].tried;return s/t.length/1e3},t}(),BarSubmissionsPerTasks=function(){function t(t,s){this.course_id=t,this.id_div=s||"submissions_per_task",this.RESOURCE_URL="/api/stats/student/bar_submissions_per_tasks",this.normalize=!1}return t.prototype=Object.create(Statistic.prototype),t.prototype._fetchData=function(){return $.getJSON(this.RESOURCE_URL,{course_id:this.course_id})},t.prototype.toggleNormalize=function(){this.normalize=!this.normalize,this.plotAsync()},t.prototype._plotData=function(t){for(var s={},e=[],i=0;i<t.length;++i)null==s[t[i].task_id]&&(s[t[i].task_id]=0,e.push(t[i].task_id)),s[t[i].task_id]+=t[i].count;var r=UserStatistics.colors,a=[this.createObjectToPlotData(t,s,"COMPILATION_ERROR",r.COMPILATION_ERROR),this.createObjectToPlotData(t,s,"TIME_LIMIT_EXCEEDED",r.TIME_LIMIT_EXCEEDED),this.createObjectToPlotData(t,s,"MEMORY_LIMIT_EXCEEDED",r.MEMORY_LIMIT_EXCEEDED),this.createObjectToPlotData(t,s,"RUNTIME_ERROR",r.RUNTIME_ERROR),this.createObjectToPlotData(t,s,"WRONG_ANSWER",r.WRONG_ANSWER),this.createObjectToPlotData(t,s,"INTERNAL_ERROR",r.INTERNAL_ERROR),this.createObjectToPlotData(t,s,"ACCEPTED",r.ACCEPTED)],o={barmode:"stack",title:"Submissions vs Task",xaxis:{title:"Tasks",categoryorder:"array",categoryarray:e,titlefont:{size:16,color:"rgb(107, 107, 107)"}},yaxis:{title:this.normalize?"Percentage of submissions":"Number of submissions",titlefont:{size:16,color:"rgb(107, 107, 107)"}}};Plotly.purge(this.id_div),Plotly.newPlot(this.id_div,a,o)},t.prototype.createObjectToPlotData=function(t,s,e,i){for(var r={x:[],y:[],marker:{color:i},name:e,type:"bar"},a=0;a<t.length;++a)t[a].summary_result===e&&(r.x.push(t[a].task_id),this.normalize?r.y.push(t[a].count/s[t[a].task_id]*100):r.y.push(t[a].count));return r},t}();$(function(){UserStatistics.course_id=getCourseId(),UserStatistics.trialsAndBestGradeStatistic=new UserTrialsAndBestGradeStatistic(UserStatistics.course_id),UserStatistics.barSubmissionsPerTasks=new BarSubmissionsPerTasks(UserStatistics.course_id);var t={"trials-circle-tab":UserStatistics.trialsAndBestGradeStatistic,"bar-submissions-per-tasks-tab":UserStatistics.barSubmissionsPerTasks};$('a[data-toggle="tab"]').on("shown.bs.tab",function(s){var e=t[s.target.id];e&&e.plotAsync()}),$('.active > a[data-toggle="tab"]').trigger("shown.bs.tab")});